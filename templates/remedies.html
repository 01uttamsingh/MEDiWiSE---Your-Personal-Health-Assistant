{% extends "layout.html" %}

{% block title %}Home Remedies - MEDiWiSE{% endblock %}

{% block styles %}
<!-- Internal Styles for Remedies Section -->
<style>
  .remedies-wrapper {
    background-color: #0F0F0F;
    padding: 100px var(--dl-layout-space-oneandhalfunits);
    color: white;
    font-family: 'Poppins', sans-serif;
  }

  .remedies-container {
    max-width: 800px;
    margin: 0 auto;
    text-align: center;
  }

  .remedies-header {
    margin-bottom: 40px;
  }

  .remedies-header h2 {
    font-size: 40px;
    font-weight: 600;
    margin-bottom: 15px;
  }

  .remedies-header p {
    font-size: 16px;
    color: #a0a0a0;
    line-height: 1.6;
    max-width: 600px;
    margin: 0 auto;
  }

  .remedy-chat-box {
    background-color: #1A1A1A;
    border: 1px solid #51515A;
    border-radius: 15px;
    height: 500px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }

  .remedy-messages {
    flex-grow: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .remedy-messages::-webkit-scrollbar {
    width: 8px;
  }

  .remedy-messages::-webkit-scrollbar-track {
    background: #1A1A1A;
  }

  .remedy-messages::-webkit-scrollbar-thumb {
    background-color: #51515A;
    border-radius: 10px;
  }

  .message-wrapper {
    display: flex;
    align-items: flex-end;
    gap: 10px;
    max-width: 85%;
  }

  .bot-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    overflow: hidden;
    flex-shrink: 0;
    background-color: #292929;
  }

  .bot-avatar img {
    width: 100%;
    height: 100%;
  }

  .message {
    padding: 12px 18px;
    border-radius: 20px;
    line-height: 1.5;
    text-align: left;
  }

  .bot-message {
    background-color: #292929;
    border-bottom-left-radius: 5px;
  }

  .bot-message.typing-indicator {
    font-style: italic;
    color: #a0a0a0;
  }

  .user-query-wrapper {
    align-self: flex-end;
  }

  .user-query {
    background-color: #80FF44;
    color: #0F0F0F;
    font-weight: 500;
    border-bottom-right-radius: 5px;
  }

  .bot-message ul {
    list-style-type: none;
    padding-left: 5px;
    margin-top: 10px;
  }

  .bot-message li {
    margin-bottom: 8px;
    padding-left: 5px;
  }

  .loading-dots span {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #80FF44;
    animation: bounce 1.4s infinite ease-in-out both;
  }

  .loading-dots span:nth-child(1) {
    animation-delay: -0.32s;
  }

  .loading-dots span:nth-child(2) {
    animation-delay: -0.16s;
  }

  @keyframes bounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1.0); }
  }

  .remedy-input-area {
    display: flex;
    padding: 15px;
    border-top: 1px solid #51515A;
    background-color: #0F0F0F;
  }

  .remedy-input-area.disabled {
    opacity: 0.5;
    pointer-events: none;
  }

  .remedy-input-area input {
    flex-grow: 1;
    background-color: #292929;
    border: 1px solid transparent;
    border-radius: 25px;
    padding: 12px 20px;
    color: white;
    font-size: 16px;
    outline: none;
    transition: border-color 0.3s;
  }

  .remedy-input-area input:focus {
    border-color: #80FF44;
  }

  .remedy-input-area button {
    background-color: #80FF44;
    border: none;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    margin-left: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s, transform 0.2s;
  }

  .remedy-input-area button:hover {
    background-color: #6ee02a;
    transform: scale(1.1);
  }

  .remedy-input-area button svg {
    stroke: #0F0F0F;
    width: 20px;
    height: 20px;
  }

  .powered-by-section {
    padding: 60px var(--dl-layout-space-oneandhalfunits);
    text-align: center;
    border-top: 1px solid #51515A;
    margin-top: 40px;
  }
  .powered-by-title {
    font-size: 18px;
    font-weight: 500;
    color: #a0a0a0;
    margin-bottom: 30px;
    font-family: 'Poppins', sans-serif;
  }
  .logos-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 40px;
  }
  .logo-img {
    height: 40px;
    opacity: 0.8;
  }
</style>
{% endblock %}

{% block content %}
<!-- Home Remedies Section -->
<section id="remedies-section" class="remedies-wrapper">
  <div class="remedies-container">
    <header class="remedies-header">
      <h2>Remedies You Can Try at Home</h2>
      <p>Enter the name of a common disease below to get a list of potential home remedies. This is for emergency
        and short-term relief. Please Consult a doctor, Thank You!</p>
    </header>
    <div class="remedy-chat-box">
      <div id="remedy-messages" class="remedy-messages">
        <div class="message-wrapper">
          <div class="bot-avatar"><img src="{{ url_for('static', filename='img/chatbot.png') }}" alt="Bot Avatar" /></div>
          <div class="message bot-message">
            <p>Hello! I am MedTed. Please type the name of a common ailment (e.g., "Cold", "Headache", "Fever")
              below, and I'll suggest some home remedies.</p>
          </div>
        </div>
      </div>
      <form id="remedy-form" class="remedy-input-area">
        <input type="text" id="disease-input" placeholder="Type a disease name..." autocomplete="off" required>
        <button type="submit" aria-label="Send">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </form>
    </div>
  </div>
</section>

<!-- "Powered By" Section with Local Images -->
<section class="powered-by-section">
    <h3 class="powered-by-title">Powered By</h3>
    <div class="logos-container">
        <img src="{{ url_for('static', filename='img/google.png') }}" alt="Google Logo" class="logo-img">
        <img src="{{ url_for('static', filename='img/aistudio.png') }}" alt="AI Studio Logo" class="logo-img">
        <img src="{{ url_for('static', filename='img/gemini.png') }}" alt="Gemini Logo" class="logo-img">
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const remedyForm = document.getElementById('remedy-form');
    const diseaseInput = document.getElementById('disease-input');
    const remedyMessages = document.getElementById('remedy-messages');

    remedyForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const userInput = diseaseInput.value.trim();
      if (!userInput) return;

      appendMessage(userInput, 'user');
      diseaseInput.value = '';
      appendMessage('...', 'loading');
      
      remedyForm.classList.add('disabled');

      try {
        const response = await fetch('/api/get_remedies', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ disease: userInput })
        });
        const data = await response.json();
        
        document.getElementById('loading-message')?.remove();

        const typingIndicator = appendMessage('MedTed is typing...', 'typing');
        
        const delay = Math.random() * 800 + 700;
        setTimeout(() => {
            typingIndicator?.remove();
            
            if (data.error) {
                appendMessage(data.error, 'bot');
            } else {
                const text = data.remedies;
                if (text.includes('\n')) {
                    const remediesList = text.split('\n').filter(Boolean);
                    const formattedRemedies = `<ul>${remediesList.map(r => `<li>${r}</li>`).join('')}</ul>`;
                    appendMessage(formattedRemedies, 'bot');
                } else {
                    appendMessage(text, 'bot');
                }
            }
            remedyForm.classList.remove('disabled');
        }, delay);

      } catch (error) {
        document.getElementById('loading-message')?.remove();
        appendMessage('Sorry, I could not connect to the server.', 'bot');
        console.error('Fetch Error:', error);
        remedyForm.classList.remove('disabled');
      }
    });

    function appendMessage(text, type) {
      const messageWrapper = document.createElement('div');
      messageWrapper.className = 'message-wrapper';
      
      if (type === 'bot') {
        messageWrapper.innerHTML = `<div class="bot-avatar"><img src="{{ url_for('static', filename='img/chatbot.png') }}" alt="Bot Avatar" /></div><div class="message bot-message">${text}</div>`;
      } else if (type === 'user') {
        messageWrapper.className += ' user-query-wrapper';
        messageWrapper.innerHTML = `<div class="message user-query">${text}</div>`;
      } else if (type === 'loading') {
        messageWrapper.id = 'loading-message';
        messageWrapper.innerHTML = `<div class="bot-avatar"><img src="{{ url_for('static', filename='img/chatbot.png') }}" alt="Bot Avatar" /></div><div class="message bot-message loading-dots"><span></span><span></span><span></span></div>`;
      } else if (type === 'typing') {
        messageWrapper.id = 'typing-indicator';
        messageWrapper.innerHTML = `<div class="bot-avatar"><img src="{{ url_for('static', filename='img/chatbot.png') }}" alt="Bot Avatar" /></div><div class="message bot-message typing-indicator">${text}</div>`;
      }

      remedyMessages.appendChild(messageWrapper);
      remedyMessages.scrollTop = remedyMessages.scrollHeight;
      
      return messageWrapper;
    }
  });
</script>
{% endblock %}

